### Описание проекта  

#### Название проекта: Мониторинг изменений данных с помощью Debezium и Grafana  

Структура проекта:  

Проект предназначен для мониторинга данных из базы данных PostgreSQL с использованием архитектуры микро-сервисов, включающей инструменты Debezium, Prometheus и Grafana. Основная цель — отслеживание изменений в данных и визуализация этих изменений через мощные и гибкие дашборды.  

#### Основные компоненты проекта:  

- Файлы конфигурации:  
  - .env: Файл окружения для хранения переменных, необходимых для настройки Docker-контейнеров.  
  - docker-compose.yml: Основной файл, позволяющий развернуть все контейнеры проекта с помощью Docker Compose. Включает конфигурации для PostgreSQL, Kafka, Zookeeper, Debezium Connector, Prometheus и Grafana.  

- Скрипты и данные:
  - inventory.sql: Скрипт, содержащий SQL-команды для создания и заполнения базы данных тестовыми данными. Включает таблицы для продуктов, клиентов и заказов, которые будут отслеживаться Debezium.  

#### Подкаталоги:

- debezium-grafana/:   
  - Содержит файлы конфигурации для Grafana, в том числе:  
    - dashboard.yml: Конфигурация для настройки панели мониторинга в Grafana.  
    - datasource.yml: Файл для определения источников данных в Grafana.  
    - debezium-dashboard.json: JSON-файл с настройками дашборда для визуализации данных, получаемых от Debezium.  
    - debezium-mysql-connector-dashboard.json: Опциональная панель мониторинга для MySQL Connector Debezium (возможно, для сравнения).  
    - Dockerfile: Определяет, как создать контейнер Grafana с необходимыми плагинами и конфигурациями.  

- debezium-jmx-exporter/:  
  - Содержит файлы для настройки JMX Exporter, который собирает метрики из приложений Java (например, из Kafka):  
    - config.yml: Конфигурация для JMX Exporter.  
    - Dockerfile: Определяет, как создать образ контейнера для JMX Exporter.  

- debezium-prometheus/:  
  - Содержит Dockerfile для создания контейнера Prometheus, который отвечает за сбор и хранение метрик из систем и приложений.  
  
#### 1. Запуск контейнеров
Убедитесь, что ваш контейнер PostgreSQL запущен. Если вы используете docker-compose, выполните:

docker-compose up -d

#### 2. Подключение к контейнеру PostgreSQL
Чтобы подключиться к PostgreSQL в контейнере, вы можете использовать команду docker exec. Если ваш контейнер называется postgres (как указано в вашем docker-compose.yml), выполните:

docker exec -it postgres psql -U postgres -d testDB

#### 3. Выполнение inventory.sql
Чтобы выполнить SQL-скрипт inventory.sql, вам нужно либо загрузить файл в контейнер, либо использовать прямой доступ к тому, где находится ваш файл.

#### Копирование файла в контейнер
Если ваш inventory.sql находится на вашем хосте, вы можете скопировать его в контейнер с помощью команды docker cp:

docker cp path/to/inventory.sql postgres:/tmp/inventory.sql

Затем, подключившись к контейнеру, выполните:

docker exec -it postgres psql -U postgres -d testDB -f /tmp/inventory.sql

### Описание файла конфигурации для Debezium Connector PostgreSQL

Файл конфигурации JSON (например, register-postgresql.json) содержит настройки для подключения Debezium к базе данных PostgreSQL и определения того, какие изменения должны отслеживаться и куда они отправляются. Основные параметры в файле включают:

- name: Имя коннектора. В данном случае это "postgres-connector".
- connector.class: Класс коннектора, который указывает, что мы используем PostgreSQL в качестве источника данных.
- tasks.max: Максимальное количество задач, которые могут быть запущены коннектором одновременно. Обычно устанавливается в 1 для PostgreSQL.
- database.hostname: Адрес базы данных PostgreSQL. Здесь это postgres, предполагая, что контейнер с PostgreSQL запущен под этим именем.
- database.port: Порт PostgreSQL. Стандартный порт — 5432.
- database.user: Имя пользователя для подключения к базе данных.
- database.password: Пароль пользователя для подключения.
- database.dbname: Имя базы данных, которую необходимо отслеживать.
- database.server.id: Уникальный идентификатор сервера для логического декодирования.
- database.server.name: Имя сервера, которое будет использоваться в темах Kafka.
- table.include.list: Список таблиц, изменения в которых нужно отслеживать.
- plugin.name: Плагин для логического декодирования, используемый в PostgreSQL.
- topic.prefix: Префикс тем Kafka, в которые будут отправляться изменения. Например, если префикс myapp, изменения в таблице public.products будут отправляться в тему myapp.public.products.

### Зачем мы используем curl

Команда curl используется для отправки POST-запроса на сервер Kafka Connect, чтобы зарегистрировать новый коннектор на основе настроек, указанных в файле конфигурации. Это действие запускает процесс отслеживания изменений в указанных таблицах PostgreSQL и их отправки в соответствующие темы Kafka. В частности, мы используем следующую команду:

curl -X POST -H "Content-Type: application/json" --data @register-postgresql.json http://localhost:8083/connectors

- -X POST: Указывает, что мы выполняем POST-запрос.
- -H "Content-Type: application/json": Устанавливает заголовок для указания типа передаваемого контента (в данном случае JSON).
- --data @register-postgresql.json: Указывает файл, содержащий данные конфигурации, которые мы отправляем.
- http://localhost:8083/connectors: URL-адрес конечной точки Kafka Connect, к которой отправляется запрос для регистрации нового коннектора.

Таким образом, команда curl и файл конфигурации совместно позволяют установить связь между Debezium и вашей базой данных PostgreSQL для эффективного отслеживания и передачи изменений данных.

### Заключение

Этот проект предоставляет разработчикам и администраторам баз данных мощную платформу для мониторинга и визуализации изменений данных в PostgreSQL. С использованием таких технологий, как Debezium, Prometheus и Grafana, вы можете эффективно отслеживать важные изменения и предоставлять актуальную информацию через интерактивные дашборды.